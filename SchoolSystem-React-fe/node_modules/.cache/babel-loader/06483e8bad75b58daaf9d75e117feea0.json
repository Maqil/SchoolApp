{"ast":null,"code":"var _jsxFileName = \"/Users/mohamedmaqil/Desktop/RIVO/rivo-portal-ui/src/providers/Auth.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useEffect, useState, createContext, useContext } from \"react\";\nimport { Auth } from \"aws-amplify\";\nimport jwt_decode from \"jwt-decode\";\nimport { getI18n } from \"react-i18next\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext({\n  user: {},\n  loading: true,\n  signIn: (username, password) => {},\n  signOut: () => {},\n  getUserSession: () => {},\n  changePassword: (user, oldPassword, newPassword) => {},\n  completeNewPassword: (user, newPassword) => {},\n  forgotPassword: username => {},\n  confirmSignIn: (user, mfaCode) => {},\n  verifyTOTP: (user, totpCode) => {},\n  updateUserAttributes: (user, attributes) => {},\n  clearCognitoData: () => {},\n  forgotPasswordSubmit: (username, code, newPassword) => {},\n  userAttributeVerification: attribute => {},\n  userAttributeVerificationSubmit: (attribute, code) => {},\n  refreshSession: () => {},\n  checkSessionExpired: () => {},\n  getSubId: () => {}\n});\nexport const AuthProvider = props => {\n  _s();\n\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true); //const [authState, setAuthState] = React.useState<AuthState>();\n  // useEffect(() => {\n  //   console.log({ loading });\n  // }, [loading]);\n\n  useEffect(() => {\n    console.log(\"here\");\n    /**\n        Get the current user's information.\n        Should be used after the user is logged in. Returns an error if not signed in\n        @return response - the result of the API call. returns data: the authenticated user object\n    */\n\n    const getCurrentUser = async () => {\n      setLoading(true);\n\n      if (user) {\n        console.log(user, \"currentUser already exisiting\");\n        setUser(user);\n        setLoading(false);\n      } else {\n        try {\n          let loggedUser = await Auth.currentAuthenticatedUser();\n          setUser(loggedUser);\n          console.log(loggedUser, \"currentUser checking aws\");\n        } catch (error) {\n          console.log(error);\n        }\n\n        setLoading(false);\n      }\n    }; //console.log(\"here\");\n\n\n    getCurrentUser(); //setLoading(false);\n  }, [user]);\n  /*    COGNITO USER FUNCTIONS    */\n\n  /**\n        Get user's current session. Refreshes accessToken and idToken if expired and a valid\n        refresh token is presented\n        @return response - the result of the API call.\n        returns a CognitoUserSession object which contains JWT, idToken, and refreshToken\n    */\n\n  const getUserSession = async () => {\n    let response = {};\n    Auth.currentSession().then(data => {\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    }).catch(error => {\n      console.error(\"An error occured while getting user session: \" + error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    });\n    return response;\n  };\n  /**\n        Update the user's attributes\n        @param attributes - object of user's attributes to be updated\n        @return response - the result from updating the attributes\n    */\n\n\n  const updateUserAttributes = async (user, attributes) => {\n    let response = {};\n    await Auth.updateUserAttributes(user, attributes).then(result => {\n      console.log(result); // SUCCESS\n\n      response = {\n        data: result,\n        status: \"SUCCESS\"\n      };\n    }).catch(error => {\n      console.error(\"An error occured while updating the user's attributes: \" + error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    });\n    return response;\n  };\n  /**\n   * Clear all the current user's cognito data\n   */\n\n\n  const clearCognitoData = () => {\n    setUser(null);\n  };\n  /*  **********  COGNITO SIGN IN/OUT  **********  */\n\n  /**\n        Sign in and authenticate user.\n        First time users must enter a new password.\n        User's info is stored to avoid recalling the API\n        @return - Authenticated User's information - For TOTP returns code\n    */\n\n\n  const signIn = async (username, password) => {\n    let response;\n    setLoading(true);\n\n    try {\n      console.log(username);\n      console.log(password);\n      let user = await Auth.signIn({\n        username,\n        password,\n        validationData: {\n          language: getI18n().resolvedLanguage\n        }\n      });\n\n      if (user.preferredMFA === \"NOMFA\") {\n        setUser(user);\n        response = {\n          data: user,\n          status: \"SUCCESS\"\n        };\n      } else {\n        response = user;\n      } //if (user.challengeName === \"MFA_SETUP\") {\n      //   // This happens when the MFA method is TOTP\n      //   // The user needs to setup the TOTP before using it\n      //   // More info please check the Enabling MFA part\n      //   let mfaCode;\n      //   Auth.setupTOTP(user).then(code => {\n      //     mfaCode = code;\n      //   });\n      //   return (response = {\n      //     data: mfaCode,\n      //     status: \"SUCCESS\"\n      //   });\n      // } else {\n      //   setUser(user);\n      //   setLoading(false);\n      //   // The user directly signs in\n      //   return (response = {\n      //     data: user,\n      //     status: \"SUCCESS\"\n      //   });\n      // }\n\n    } catch (error) {\n      console.debug(\"An error occured while getting user information: \" + error.message);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n\n    setLoading(false);\n    return response;\n  };\n  /**\n   * Complete login for user after submitting MFA code\n   * @param user\n   * @param mfaCode\n   * @returns response - successful verification returns user object\n   */\n\n\n  const confirmSignIn = async (user, mfaCode) => {\n    let response;\n    let loggedUser;\n    setLoading(true);\n\n    try {\n      if (user.challengeName === \"CUSTOM_CHALLENGE\") {\n        loggedUser = await Auth.sendCustomChallengeAnswer(user, // Return object from Auth.signIn()\n        mfaCode // Confirmation code\n        );\n      } else {\n        loggedUser = await Auth.confirmSignIn(user, // Return object from Auth.signIn()\n        mfaCode // Confirmation code\n        );\n      }\n\n      setUser(loggedUser);\n      response = {\n        data: loggedUser,\n        status: \"SUCCESS\"\n      };\n    } catch (error) {\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n\n    setLoading(false);\n    return response;\n  };\n  /**\n   * Verify One-time password from cognito\n   * @param user\n   * @param totpCode\n   * @return response - successful verification returns user object\n   */\n\n\n  const verifyTOTP = async (user, totpCode) => {\n    let response;\n    Auth.verifyTotpToken(user, totpCode).then(user => {\n      // don't forget to set TOTP as the preferred MFA method\n      Auth.setPreferredMFA(user, \"TOTP\"); // ...\n\n      response = {\n        data: user,\n        status: \"SUCCESS\"\n      };\n    }).catch(error => {\n      console.log(\"An error occured during verification: \" + error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    });\n    return response;\n  };\n  /**\n   * Sign user out of cognito\n   * @return response - a successful sign-out returns a \"SUCCESS\" status\n   */\n\n\n  const signOut = async () => {\n    let response;\n    setLoading(true);\n\n    try {\n      let data = await Auth.signOut();\n      console.log(\"User successfully signed out\");\n      clearCognitoData();\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n      setLoading(false);\n    } catch (error) {\n      console.error(\"An error occured during sign out: \", error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n\n    return response;\n  };\n  /*  **********  COGNITO PASSWORD FUNCTIONS  **********  */\n\n  /**\n   * Change user's password\n   * @param user\n   * @param oldPassword\n   * @param newPassword\n   * @return response - A successful request returns a promise\n   */\n\n\n  const changePassword = async (user, oldPassword, newPassword) => {\n    let response;\n\n    try {\n      let data = await Auth.changePassword(user, oldPassword, newPassword);\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    } catch (error) {\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n\n    return response;\n  };\n  /**\n   * Change a new user's password\n   * @param user\n   * @param newPassword\n   * @return response - A successful request returns a promise\n   */\n\n\n  const completeNewPassword = async (user, newPassword) => {\n    let response;\n    setLoading(true);\n\n    try {\n      let data = await Auth.completeNewPassword(user, // the Cognito User Object\n      newPassword // the new password\n      );\n\n      if (data.authenticationFlowType === \"CUSTOM_AUTH\") {\n        console.log(\"CUSTOM AUTH COMPLETE PASSWORD\");\n        setUser(data);\n      }\n\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    } catch (error) {\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n\n    setLoading(false);\n    return response;\n  };\n  /**\n   * Send user a link to reset the password\n   * @param username\n   * @return response - A successful request returns a promise\n   */\n\n\n  const forgotPassword = async username => {\n    let response;\n    setLoading(true);\n\n    try {\n      let data = await Auth.forgotPassword(username, {\n        language: getI18n().resolvedLanguage\n      });\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    } catch (error) {\n      console.error(\"An unexpected error occured: \" + error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n\n    setLoading(false);\n    return response;\n  };\n  /**\n   * Sumbit the verification code along with the user's new password\n   * @param username\n   * @param code - MFA code from cognito\n   * @param new_password\n   * @return response - A promise on success\n   */\n\n\n  const forgotPasswordSubmit = async (username, code, newPassword) => {\n    let response;\n    setLoading(true);\n\n    try {\n      let data = await Auth.forgotPasswordSubmit(username, code, newPassword);\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    } catch (error) {\n      console.error(\"An error occured while submiting the verification code: \" + error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n\n    setLoading(false);\n    return response;\n  };\n  /**\n   * Send verification code to user's preffered method of communication\n   * @param attribute - user attribute to verify (email/sms)\n   * @return response - a promise data object on success\n   */\n\n\n  const userAttributeVerification = async attribute => {\n    let response = {};\n    Auth.verifyCurrentUserAttribute(attribute).then(data => {\n      console.log(\"A verification code was sent to: \" + attribute);\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    }).catch(error => {\n      console.error(\"An error occured while verifying: \" + attribute + \" : \" + error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    });\n    return response;\n  };\n  /**\n   * Submit verification code for attribute\n   * @param attribute\n   * @param code\n   * @returns response - a promise data object on success\n   */\n\n\n  const userAttributeVerificationSubmit = async (attribute, code) => {\n    let response;\n    Auth.verifyCurrentUserAttributeSubmit(attribute, code).then(data => {\n      console.log(attribute + \" verified\");\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    }).catch(error => {\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    });\n    return response;\n  };\n  /**\n   * Submit verification code for attribute\n   * @returns response - a promise data object on success\n   */\n\n\n  const refreshSession = async () => {\n    try {\n      const cognitoUser = await Auth.currentAuthenticatedUser();\n      console.log(\"COGNITIO USER\", cognitoUser);\n      const {\n        refreshToken\n      } = cognitoUser.getSignInUserSession();\n      console.log(\"REFRESH TOKEN\", refreshToken);\n      cognitoUser.refreshSession(refreshToken, (err, session) => {\n        console.log(\"error\", err);\n        console.log(\">>>>>>>>>>>>>>>>>>>>>>>>> REFRESHED TOKEN SESSSION!\", session);\n\n        if (session) {\n          const {\n            accessToken\n          } = session;\n          let jwt = accessToken.getJwtToken();\n          let jwtObject = jwt_decode(jwt);\n          let expireTime = jwtObject.exp;\n          sessionStorage.removeItem(\"alertMessage\");\n          sessionStorage.setItem(\"expiry\", String(expireTime));\n          console.log(\"NEW EXPIRY TIME\", expireTime);\n        }\n      });\n    } catch (e) {\n      console.log(\"Unable to refresh Token\", e);\n    }\n  };\n\n  const checkSessionExpired = async () => {\n    let response = {};\n\n    try {\n      let currentTime = Math.floor(Date.now() / 1000);\n      console.log(`CURRENTTIME: ${currentTime}`);\n      let expiryTime = Number(sessionStorage.getItem(\"expiry\")) || null;\n      console.log(\"EXPIRY TIME\", expiryTime);\n\n      if (expiryTime && currentTime > expiryTime) {\n        //logout\n        console.log(\">>>>>>>>>>>>>>>>>>>>>>>>> EXPIRED SESSSION!\");\n        sessionStorage.removeItem(\"expiry\");\n        response = {\n          showAlert: true,\n          severity: \"error\",\n          message: \"all.alert.session-expired\"\n        };\n        sessionStorage.setItem(\"alertMessage\", JSON.stringify(response));\n        await signOut();\n      } else {\n        console.log(\">>>>>REFRESHING SESSION\"); //refresh\n\n        await refreshSession();\n      }\n    } catch (e) {\n      console.log(\"Error\", e);\n    }\n\n    return response;\n  };\n  /**\n   * Submit verification code for attribute\n   * @returns response - a promise data object on success\n   */\n\n\n  const getSubId = async () => {\n    try {\n      const cognitoUser = await Auth.currentAuthenticatedUser();\n      const {\n        idToken\n      } = cognitoUser.getSignInUserSession();\n      return idToken.payload.sub;\n    } catch (e) {\n      console.log(\"Unable to refresh Token\", e);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      loading,\n      signIn,\n      signOut,\n      getUserSession,\n      changePassword,\n      completeNewPassword,\n      forgotPassword,\n      confirmSignIn,\n      verifyTOTP,\n      updateUserAttributes,\n      clearCognitoData,\n      forgotPasswordSubmit,\n      userAttributeVerification,\n      userAttributeVerificationSubmit,\n      refreshSession,\n      checkSessionExpired,\n      getSubId\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 540,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AuthProvider, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");\n\n_c = AuthProvider;\nexport const useAuth = () => {\n  _s2();\n\n  return useContext(AuthContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/mohamedmaqil/Desktop/RIVO/rivo-portal-ui/src/providers/Auth.tsx"],"names":["React","useEffect","useState","createContext","useContext","Auth","jwt_decode","getI18n","AuthContext","user","loading","signIn","username","password","signOut","getUserSession","changePassword","oldPassword","newPassword","completeNewPassword","forgotPassword","confirmSignIn","mfaCode","verifyTOTP","totpCode","updateUserAttributes","attributes","clearCognitoData","forgotPasswordSubmit","code","userAttributeVerification","attribute","userAttributeVerificationSubmit","refreshSession","checkSessionExpired","getSubId","AuthProvider","props","setUser","setLoading","console","log","getCurrentUser","loggedUser","currentAuthenticatedUser","error","response","currentSession","then","data","status","catch","result","validationData","language","resolvedLanguage","preferredMFA","debug","message","challengeName","sendCustomChallengeAnswer","verifyTotpToken","setPreferredMFA","authenticationFlowType","verifyCurrentUserAttribute","verifyCurrentUserAttributeSubmit","cognitoUser","refreshToken","getSignInUserSession","err","session","accessToken","jwt","getJwtToken","jwtObject","expireTime","exp","sessionStorage","removeItem","setItem","String","e","currentTime","Math","floor","Date","now","expiryTime","Number","getItem","showAlert","severity","JSON","stringify","idToken","payload","sub","children","useAuth"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, createContext, useContext } from \"react\";\nimport { Auth } from \"aws-amplify\";\nimport { CognitoUserInterface } from \"@aws-amplify/ui-components\";\nimport jwt_decode from \"jwt-decode\";\nimport { getI18n } from \"react-i18next\";\n\nconst AuthContext = createContext({\n  user: {} as CognitoUserInterface | null,\n  loading: true as boolean | null,\n\n  signIn: (username, password) => {},\n  signOut: () => {},\n  getUserSession: () => {},\n  changePassword: (user, oldPassword, newPassword) => {},\n  completeNewPassword: (user, newPassword) => {},\n  forgotPassword: username => {},\n  confirmSignIn: (user, mfaCode) => {},\n  verifyTOTP: (user, totpCode) => {},\n  updateUserAttributes: (user, attributes) => {},\n  clearCognitoData: () => {},\n  forgotPasswordSubmit: (username, code, newPassword) => {},\n  userAttributeVerification: attribute => {},\n  userAttributeVerificationSubmit: (attribute, code) => {},\n  refreshSession: () => {},\n  checkSessionExpired: () => {},\n  getSubId: () => {}\n});\n\nexport const AuthProvider = props => {\n  const [user, setUser] = useState<CognitoUserInterface | null>(null);\n  const [loading, setLoading] = useState(true);\n  //const [authState, setAuthState] = React.useState<AuthState>();\n\n  // useEffect(() => {\n  //   console.log({ loading });\n  // }, [loading]);\n\n  useEffect(() => {\n    console.log(\"here\");\n    /**\n        Get the current user's information.\n        Should be used after the user is logged in. Returns an error if not signed in\n        @return response - the result of the API call. returns data: the authenticated user object\n    */\n    const getCurrentUser = async () => {\n      setLoading(true);\n      if (user) {\n        console.log(user, \"currentUser already exisiting\");\n        setUser(user);\n        setLoading(false);\n      } else {\n        try {\n          let loggedUser = await Auth.currentAuthenticatedUser();\n          setUser(loggedUser);\n\n          console.log(loggedUser, \"currentUser checking aws\");\n        } catch (error: any) {\n          console.log(error);\n        }\n        setLoading(false);\n      }\n    };\n    //console.log(\"here\");\n    getCurrentUser();\n    //setLoading(false);\n  }, [user]);\n\n  /*    COGNITO USER FUNCTIONS    */\n\n  /**\n        Get user's current session. Refreshes accessToken and idToken if expired and a valid\n        refresh token is presented\n        @return response - the result of the API call.\n        returns a CognitoUserSession object which contains JWT, idToken, and refreshToken\n    */\n  const getUserSession = async () => {\n    let response = {};\n    Auth.currentSession()\n      .then(data => {\n        response = {\n          data: data,\n          status: \"SUCCESS\"\n        };\n      })\n      .catch(error => {\n        console.error(\"An error occured while getting user session: \" + error);\n        response = {\n          error: error,\n          status: \"FAIL\"\n        };\n      });\n    return response;\n  };\n\n  /**\n        Update the user's attributes\n        @param attributes - object of user's attributes to be updated\n        @return response - the result from updating the attributes\n    */\n  const updateUserAttributes = async (user, attributes: object) => {\n    let response = {};\n    await Auth.updateUserAttributes(user, attributes)\n      .then(result => {\n        console.log(result); // SUCCESS\n        response = {\n          data: result,\n          status: \"SUCCESS\"\n        };\n      })\n      .catch(error => {\n        console.error(\n          \"An error occured while updating the user's attributes: \" + error\n        );\n        response = {\n          error: error,\n          status: \"FAIL\"\n        };\n      });\n    return response;\n  };\n\n  /**\n   * Clear all the current user's cognito data\n   */\n  const clearCognitoData = () => {\n    setUser(null);\n  };\n\n  /*  **********  COGNITO SIGN IN/OUT  **********  */\n\n  /**\n        Sign in and authenticate user.\n        First time users must enter a new password.\n        User's info is stored to avoid recalling the API\n        @return - Authenticated User's information - For TOTP returns code\n    */\n  const signIn = async (username: string, password: string) => {\n    let response;\n    setLoading(true);\n    try {\n      console.log(username);\n      console.log(password);\n      let user = await Auth.signIn({\n        username,\n        password,\n        validationData: { language: getI18n().resolvedLanguage }\n      });\n\n      if (user.preferredMFA === \"NOMFA\") {\n        setUser(user);\n        response = {\n          data: user,\n          status: \"SUCCESS\"\n        };\n      } else {\n        response = user;\n      }\n      //if (user.challengeName === \"MFA_SETUP\") {\n      //   // This happens when the MFA method is TOTP\n      //   // The user needs to setup the TOTP before using it\n      //   // More info please check the Enabling MFA part\n\n      //   let mfaCode;\n      //   Auth.setupTOTP(user).then(code => {\n      //     mfaCode = code;\n      //   });\n      //   return (response = {\n      //     data: mfaCode,\n      //     status: \"SUCCESS\"\n      //   });\n      // } else {\n      //   setUser(user);\n      //   setLoading(false);\n      //   // The user directly signs in\n      //   return (response = {\n      //     data: user,\n      //     status: \"SUCCESS\"\n      //   });\n      // }\n    } catch (error: any) {\n      console.debug(\n        \"An error occured while getting user information: \" + error.message\n      );\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n    setLoading(false);\n    return response;\n  };\n\n  /**\n   * Complete login for user after submitting MFA code\n   * @param user\n   * @param mfaCode\n   * @returns response - successful verification returns user object\n   */\n  const confirmSignIn = async (user: any, mfaCode: string) => {\n    let response;\n    let loggedUser;\n    setLoading(true);\n    try {\n      if (user.challengeName === \"CUSTOM_CHALLENGE\") {\n        loggedUser = await Auth.sendCustomChallengeAnswer(\n          user, // Return object from Auth.signIn()\n          mfaCode // Confirmation code\n        );\n      } else {\n        loggedUser = await Auth.confirmSignIn(\n          user, // Return object from Auth.signIn()\n          mfaCode // Confirmation code\n        );\n      }\n\n      setUser(loggedUser);\n      response = {\n        data: loggedUser,\n        status: \"SUCCESS\"\n      };\n    } catch (error: any) {\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n    setLoading(false);\n    return response;\n  };\n\n  /**\n   * Verify One-time password from cognito\n   * @param user\n   * @param totpCode\n   * @return response - successful verification returns user object\n   */\n  const verifyTOTP = async (user, totpCode: string) => {\n    let response;\n    Auth.verifyTotpToken(user, totpCode)\n      .then(user => {\n        // don't forget to set TOTP as the preferred MFA method\n        Auth.setPreferredMFA(user, \"TOTP\");\n        // ...\n        response = {\n          data: user,\n          status: \"SUCCESS\"\n        };\n      })\n      .catch(error => {\n        console.log(\"An error occured during verification: \" + error);\n        response = {\n          error: error,\n          status: \"FAIL\"\n        };\n      });\n    return response;\n  };\n\n  /**\n   * Sign user out of cognito\n   * @return response - a successful sign-out returns a \"SUCCESS\" status\n   */\n  const signOut = async () => {\n    let response;\n    setLoading(true);\n    try {\n      let data = await Auth.signOut();\n      console.log(\"User successfully signed out\");\n      clearCognitoData();\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n      setLoading(false);\n    } catch (error: any) {\n      console.error(\"An error occured during sign out: \", error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n    return response;\n  };\n\n  /*  **********  COGNITO PASSWORD FUNCTIONS  **********  */\n\n  /**\n   * Change user's password\n   * @param user\n   * @param oldPassword\n   * @param newPassword\n   * @return response - A successful request returns a promise\n   */\n  const changePassword = async (\n    user: any,\n    oldPassword: string,\n    newPassword: string\n  ) => {\n    let response;\n    try {\n      let data = await Auth.changePassword(user, oldPassword, newPassword);\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    } catch (error: any) {\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n    return response;\n  };\n\n  /**\n   * Change a new user's password\n   * @param user\n   * @param newPassword\n   * @return response - A successful request returns a promise\n   */\n  const completeNewPassword = async (user: any, newPassword: string) => {\n    let response;\n    setLoading(true);\n    try {\n      let data = await Auth.completeNewPassword(\n        user, // the Cognito User Object\n        newPassword // the new password\n      );\n\n      if (data.authenticationFlowType === \"CUSTOM_AUTH\") {\n        console.log(\"CUSTOM AUTH COMPLETE PASSWORD\");\n        setUser(data);\n      }\n\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    } catch (error: any) {\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n    setLoading(false);\n    return response;\n  };\n\n  /**\n   * Send user a link to reset the password\n   * @param username\n   * @return response - A successful request returns a promise\n   */\n  const forgotPassword = async (username: string) => {\n    let response;\n    setLoading(true);\n    try {\n      let data = await Auth.forgotPassword(username, {\n        language: getI18n().resolvedLanguage\n      });\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    } catch (error: any) {\n      console.error(\"An unexpected error occured: \" + error);\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n    setLoading(false);\n    return response;\n  };\n\n  /**\n   * Sumbit the verification code along with the user's new password\n   * @param username\n   * @param code - MFA code from cognito\n   * @param new_password\n   * @return response - A promise on success\n   */\n  const forgotPasswordSubmit = async (\n    username: string,\n    code: string,\n    newPassword: string\n  ) => {\n    let response;\n    setLoading(true);\n    try {\n      let data = await Auth.forgotPasswordSubmit(username, code, newPassword);\n      response = {\n        data: data,\n        status: \"SUCCESS\"\n      };\n    } catch (error: any) {\n      console.error(\n        \"An error occured while submiting the verification code: \" + error\n      );\n      response = {\n        error: error,\n        status: \"FAIL\"\n      };\n    }\n    setLoading(false);\n    return response;\n  };\n\n  /**\n   * Send verification code to user's preffered method of communication\n   * @param attribute - user attribute to verify (email/sms)\n   * @return response - a promise data object on success\n   */\n  const userAttributeVerification = async (attribute: string) => {\n    let response = {};\n    Auth.verifyCurrentUserAttribute(attribute)\n      .then(data => {\n        console.log(\"A verification code was sent to: \" + attribute);\n        response = {\n          data: data,\n          status: \"SUCCESS\"\n        };\n      })\n      .catch(error => {\n        console.error(\n          \"An error occured while verifying: \" + attribute + \" : \" + error\n        );\n        response = {\n          error: error,\n          status: \"FAIL\"\n        };\n      });\n    return response;\n  };\n\n  /**\n   * Submit verification code for attribute\n   * @param attribute\n   * @param code\n   * @returns response - a promise data object on success\n   */\n  const userAttributeVerificationSubmit = async (\n    attribute: string,\n    code: string\n  ) => {\n    let response;\n    Auth.verifyCurrentUserAttributeSubmit(attribute, code)\n      .then(data => {\n        console.log(attribute + \" verified\");\n        response = {\n          data: data,\n          status: \"SUCCESS\"\n        };\n      })\n      .catch(error => {\n        response = {\n          error: error,\n          status: \"FAIL\"\n        };\n      });\n    return response;\n  };\n\n  /**\n   * Submit verification code for attribute\n   * @returns response - a promise data object on success\n   */\n  const refreshSession = async () => {\n    try {\n      const cognitoUser = await Auth.currentAuthenticatedUser();\n      console.log(\"COGNITIO USER\", cognitoUser);\n      const { refreshToken } = cognitoUser.getSignInUserSession();\n      console.log(\"REFRESH TOKEN\", refreshToken);\n      cognitoUser.refreshSession(refreshToken, (err, session) => {\n        console.log(\"error\", err);\n        console.log(\n          \">>>>>>>>>>>>>>>>>>>>>>>>> REFRESHED TOKEN SESSSION!\",\n          session\n        );\n        if (session) {\n          const { accessToken } = session;\n          let jwt = accessToken.getJwtToken();\n          let jwtObject = jwt_decode(jwt) as any;\n          let expireTime = jwtObject.exp as number;\n          sessionStorage.removeItem(\"alertMessage\");\n          sessionStorage.setItem(\"expiry\", String(expireTime));\n          console.log(\"NEW EXPIRY TIME\", expireTime);\n        }\n      });\n    } catch (e) {\n      console.log(\"Unable to refresh Token\", e);\n    }\n  };\n\n  const checkSessionExpired = async () => {\n    let response = {};\n    try {\n      let currentTime = Math.floor(Date.now() / 1000);\n      console.log(`CURRENTTIME: ${currentTime}`);\n      let expiryTime = Number(sessionStorage.getItem(\"expiry\")) || null;\n      console.log(\"EXPIRY TIME\", expiryTime);\n      if (expiryTime && currentTime > expiryTime) {\n        //logout\n        console.log(\">>>>>>>>>>>>>>>>>>>>>>>>> EXPIRED SESSSION!\");\n        sessionStorage.removeItem(\"expiry\");\n\n        response = {\n          showAlert: true,\n          severity: \"error\",\n          message: \"all.alert.session-expired\"\n        };\n        sessionStorage.setItem(\"alertMessage\", JSON.stringify(response));\n        await signOut();\n      } else {\n        console.log(\">>>>>REFRESHING SESSION\");\n        //refresh\n        await refreshSession();\n      }\n    } catch (e) {\n      console.log(\"Error\", e);\n    }\n    return response;\n  };\n\n  /**\n   * Submit verification code for attribute\n   * @returns response - a promise data object on success\n   */\n  const getSubId = async () => {\n    try {\n      const cognitoUser = await Auth.currentAuthenticatedUser();\n      const { idToken } = cognitoUser.getSignInUserSession();\n      return idToken.payload.sub;\n    } catch (e) {\n      console.log(\"Unable to refresh Token\", e);\n    }\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        loading,\n        signIn,\n        signOut,\n        getUserSession,\n        changePassword,\n        completeNewPassword,\n        forgotPassword,\n        confirmSignIn,\n        verifyTOTP,\n        updateUserAttributes,\n        clearCognitoData,\n        forgotPasswordSubmit,\n        userAttributeVerification,\n        userAttributeVerificationSubmit,\n        refreshSession,\n        checkSessionExpired,\n        getSubId\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  return useContext(AuthContext);\n};\n"]},"metadata":{},"sourceType":"module"}