{"ast":null,"code":"var _jsxFileName = \"/Users/mohamedmaqil/Desktop/RIVO/rivo-portal-ui/src/providers/ShipmentsProvider.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React from \"react\";\nimport { defaultShipmentData } from \"../interfaces/ShipmentDataInterface\";\nimport { defaultPaginationData } from \"../interfaces/PaginationDataInterface\";\nimport { defaultShipmentOverview } from \"../interfaces/ShipmentsOverviewInterface\";\nimport { defaultShipmentQuery } from \"../interfaces/ShipmentQueryInterface\";\nimport { useApiError } from \"./ApiErrorProvider\";\nimport { error } from \"../constants/bindings\";\nimport SignRequest from \"../helpers/SignRequest\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ShipmentsContext = /*#__PURE__*/React.createContext({\n  loading: true,\n  shipmentsData: [defaultShipmentData],\n  shipmentsOverview: defaultShipmentOverview,\n  paginationData: defaultPaginationData,\n  shipmentsQuery: defaultShipmentQuery,\n  getShipmentsData: date => {}\n});\nexport const ShipmentsProvider = props => {\n  _s();\n\n  const [shipmentsQuery, setShipmentsQuery] = React.useState(defaultShipmentQuery);\n  const [shipmentsData, setShipmentsData] = React.useState([]);\n  const [shipmentsOverview, setShipmentsOverview] = React.useState(defaultShipmentOverview);\n  const [paginationData, setPaginationData] = React.useState(defaultPaginationData);\n  const [loading, setLoading] = React.useState(true);\n  const {\n    setErrorCode\n  } = useApiError();\n  const statusMap = [{\n    key: \"booked\",\n    value: [\"BKD\"]\n  }, {\n    key: \"accepted\",\n    value: [\"RCS\"]\n  }, {\n    key: \"inTransit\",\n    value: [\"DEP\", \"RCF\", \"RPU\", \"MAN\", \"ARR\", \"PUL\", \"DLV\"]\n  }, {\n    key: \"outForDelivery\",\n    value: [\"GDL\"]\n  }, {\n    key: \"deliveryAttempt\",\n    value: [\"ADL\"]\n  }, {\n    key: \"doorDelivered\",\n    value: [\"DLD\", \"DPU\", \"DDL\"]\n  }, {\n    key: \"missing\",\n    value: [\"MMM\"]\n  }, {\n    key: \"returnToShipper\",\n    value: [\"RTS\"]\n  }];\n\n  const findTotalCountByEvent = (data, event) => {\n    let totalCount = 0;\n    const status = statusMap.find(el => el.key === event);\n    let eventCodes = status ? status.value : [];\n\n    for (const eventCode of eventCodes) {\n      const el = data.find(el => el.event === eventCode);\n      totalCount = totalCount + (el ? el.count : 0);\n    }\n\n    return totalCount;\n  };\n\n  const getShipmentsData = async shipmentsQuery => {\n    console.log(\">>>> PROVIDER getShipmentsData! \" + JSON.stringify(shipmentsQuery, null, 2));\n    setShipmentsQuery(shipmentsQuery);\n\n    if (!shipmentsQuery) {\n      return;\n    }\n\n    setShipmentsData([]);\n    setLoading(true);\n\n    try {\n      const body = {\n        SK_ID: shipmentsQuery.account,\n        startDate: shipmentsQuery.startDate,\n        endDate: shipmentsQuery.endDate,\n        pageNumber: parseInt(shipmentsQuery.pageNumber),\n        pageSize: parseInt(shipmentsQuery.pageSize),\n        packageReference: shipmentsQuery.packageReference,\n        airWaybill: shipmentsQuery.airWaybill,\n        lastEventType: shipmentsQuery.lastEventType.toString(),\n        city: shipmentsQuery.city\n      };\n      console.log(\">>>> BODY\", JSON.stringify(body)); // CALL: https://apigw.cargo-rivo-int.digital.aircanada.com/shipment_history/details\n\n      const rawShipmentsData = await SignRequest(\"POST\", process.env.REACT_APP_API_BASE, process.env.REACT_APP_AKAMAI_DBAAS_API_URL, \"/shipment_history/details\", body).then(signedRequest => {\n        return fetch(signedRequest.api, {\n          method: \"POST\",\n          headers: signedRequest.headers,\n          body: signedRequest.data\n        });\n      }).then(response => response.json()).then(response => {\n        return response;\n      });\n      console.log(\">>>> rawShipmentsData DATA! \" + JSON.stringify(rawShipmentsData, null, 2));\n\n      if (!rawShipmentsData.results) {\n        setShipmentsData([]);\n        setPaginationData(defaultPaginationData);\n        setShipmentsOverview(shipmentsOverview);\n        return;\n      } // CALL: https://apigw.cargo-rivo-int.digital.aircanada.com/shipment_summary/details\n\n\n      const rawShipmentsOverview = await SignRequest(\"POST\", process.env.REACT_APP_API_BASE, process.env.REACT_APP_AKAMAI_DBAAS_API_URL, \"/shipment_summary/details\", body).then(signedRequest => {\n        return fetch(signedRequest.api, {\n          method: \"POST\",\n          headers: signedRequest.headers,\n          body: signedRequest.data\n        });\n      }).then(response => response.json()).then(response => {\n        return response;\n      });\n      console.log(\">>>> PROVIDER rawShipmentsOverview! \" + JSON.stringify(rawShipmentsOverview, null, 2));\n      setShipmentsData(rawShipmentsData.results);\n      setShipmentsOverview({\n        booked: findTotalCountByEvent(rawShipmentsOverview, \"booked\"),\n        accepted: findTotalCountByEvent(rawShipmentsOverview, \"accepted\"),\n        inTransit: findTotalCountByEvent(rawShipmentsOverview, \"inTransit\"),\n        outForDelivery: findTotalCountByEvent(rawShipmentsOverview, \"outForDelivery\"),\n        deliveryAttempt: findTotalCountByEvent(rawShipmentsOverview, \"deliveryAttempt\"),\n        doorDelivered: findTotalCountByEvent(rawShipmentsOverview, \"doorDelivered\"),\n        missing: findTotalCountByEvent(rawShipmentsOverview, \"missing\"),\n        returnToShipper: findTotalCountByEvent(rawShipmentsOverview, \"returnToShipper\")\n      });\n      console.log(\">>>> rawShipmentsData.currentPage= \" + rawShipmentsData.currentPage);\n      console.log(\">>>> rawShipmentsData.pageCount= \" + rawShipmentsData.pageCount);\n      console.log(\">>>> rawShipmentsData.pageSize= \" + rawShipmentsData.pageSize);\n      setPaginationData({\n        currentPage: rawShipmentsData.currentPage,\n        pageCount: rawShipmentsData.pageCount,\n        pageSize: rawShipmentsData.pageSize\n      });\n      setLoading(false);\n      return rawShipmentsData;\n    } catch (e) {\n      var _e$response;\n\n      console.log(e, \"ERROR SHIPMENTS PROVIDER\");\n\n      if ((_e$response = e.response) !== null && _e$response !== void 0 && _e$response.status) {\n        var _e$response2;\n\n        setErrorCode((_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : _e$response2.status);\n      } else {\n        console.log(\">>>> ERROR SHIPMENTS PROVIDER EXCEPTION ERROR UNDEFINED! \");\n        setErrorCode(error.DEFAULT);\n      }\n\n      setLoading(false);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(ShipmentsContext.Provider, {\n    value: {\n      loading,\n      shipmentsData,\n      shipmentsOverview,\n      paginationData,\n      shipmentsQuery,\n      getShipmentsData\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 206,\n    columnNumber: 5\n  }, this);\n};\n\n_s(ShipmentsProvider, \"b1iGAIFM7HuzhaYCewX7TFq7bRw=\", false, function () {\n  return [useApiError];\n});\n\n_c = ShipmentsProvider;\nexport const useShipments = () => {\n  _s2();\n\n  const context = React.useContext(ShipmentsContext);\n  return context;\n};\n\n_s2(useShipments, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"ShipmentsProvider\");","map":{"version":3,"sources":["/Users/mohamedmaqil/Desktop/RIVO/rivo-portal-ui/src/providers/ShipmentsProvider.tsx"],"names":["React","defaultShipmentData","defaultPaginationData","defaultShipmentOverview","defaultShipmentQuery","useApiError","error","SignRequest","ShipmentsContext","createContext","loading","shipmentsData","shipmentsOverview","paginationData","shipmentsQuery","getShipmentsData","date","ShipmentsProvider","props","setShipmentsQuery","useState","setShipmentsData","setShipmentsOverview","setPaginationData","setLoading","setErrorCode","statusMap","key","value","findTotalCountByEvent","data","event","totalCount","status","find","el","eventCodes","eventCode","count","console","log","JSON","stringify","body","SK_ID","account","startDate","endDate","pageNumber","parseInt","pageSize","packageReference","airWaybill","lastEventType","toString","city","rawShipmentsData","process","env","REACT_APP_API_BASE","REACT_APP_AKAMAI_DBAAS_API_URL","then","signedRequest","fetch","api","method","headers","response","json","results","rawShipmentsOverview","booked","accepted","inTransit","outForDelivery","deliveryAttempt","doorDelivered","missing","returnToShipper","currentPage","pageCount","e","DEFAULT","children","useShipments","context","useContext"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { \n  defaultShipmentData,\n  ShipmentDataInterface \n} from \"../interfaces/ShipmentDataInterface\";\nimport {\n  defaultPaginationData,\n  PaginationDataInterface\n} from \"../interfaces/PaginationDataInterface\";\nimport {\n  defaultShipmentOverview,\n  ShipmentsOverviewInterface\n} from \"../interfaces/ShipmentsOverviewInterface\";\nimport { defaultShipmentQuery } from \"../interfaces/ShipmentQueryInterface\";\nimport { useApiError } from \"./ApiErrorProvider\";\nimport { error } from \"../constants/bindings\";\nimport SignRequest from \"../helpers/SignRequest\";\n\nconst ShipmentsContext = React.createContext({\n  loading: true,\n  shipmentsData: [defaultShipmentData],\n  shipmentsOverview: defaultShipmentOverview,\n  paginationData: defaultPaginationData,\n  shipmentsQuery: defaultShipmentQuery,\n  getShipmentsData: date => {}\n});\n\nexport const ShipmentsProvider = props => {\n  const [shipmentsQuery, setShipmentsQuery] =\n    React.useState(defaultShipmentQuery);\n  const [shipmentsData, setShipmentsData] = React.useState<ShipmentDataInterface[]>([]);\n  const [shipmentsOverview, setShipmentsOverview] = React.useState(\n    defaultShipmentOverview\n  );\n  const [paginationData, setPaginationData] = React.useState(\n    defaultPaginationData\n  );\n  const [loading, setLoading] = React.useState(true);\n  const { setErrorCode } = useApiError();\n\n  const statusMap = [\n    { key: \"booked\", value: [\"BKD\"] },\n    { key: \"accepted\", value: [\"RCS\"] },\n    {\n      key: \"inTransit\",\n      value: [\"DEP\", \"RCF\", \"RPU\", \"MAN\", \"ARR\", \"PUL\", \"DLV\"]\n    },\n    { key: \"outForDelivery\", value: [\"GDL\"] },\n    { key: \"deliveryAttempt\", value: [\"ADL\"] },\n    { key: \"doorDelivered\", value: [\"DLD\", \"DPU\", \"DDL\"] },\n    { key: \"missing\", value: [\"MMM\"] },\n    { key: \"returnToShipper\", value: [\"RTS\"] }\n  ];\n\n  const findTotalCountByEvent = (data, event) => {\n    let totalCount = 0;\n    const status = statusMap.find(el => el.key === event);\n    let eventCodes = status ? status.value : [];\n    for (const eventCode of eventCodes) {\n      const el = data.find(el => el.event === eventCode);\n      totalCount = totalCount + (el ? el.count : 0);\n    }\n    return totalCount;\n  };\n\n  const getShipmentsData = async shipmentsQuery => {\n    console.log(\n      \">>>> PROVIDER getShipmentsData! \" +\n        JSON.stringify(shipmentsQuery, null, 2)\n    );\n    setShipmentsQuery(shipmentsQuery);\n    if (!shipmentsQuery) {\n      return;\n    }\n    setShipmentsData([]);\n    setLoading(true);\n    try {\n      const body = {\n        SK_ID: shipmentsQuery.account,\n        startDate: shipmentsQuery.startDate,\n        endDate: shipmentsQuery.endDate,\n        pageNumber: parseInt(shipmentsQuery.pageNumber),\n        pageSize:  parseInt(shipmentsQuery.pageSize),\n        packageReference: shipmentsQuery.packageReference,\n        airWaybill: shipmentsQuery.airWaybill,\n        lastEventType: shipmentsQuery.lastEventType.toString(),\n        city: shipmentsQuery.city\n      };\n\n      console.log(\">>>> BODY\", JSON.stringify(body));\n\n      // CALL: https://apigw.cargo-rivo-int.digital.aircanada.com/shipment_history/details\n      const rawShipmentsData = await SignRequest(\n        \"POST\",\n        process.env.REACT_APP_API_BASE,\n        process.env.REACT_APP_AKAMAI_DBAAS_API_URL,\n        \"/shipment_history/details\",\n        body\n      )\n        .then((signedRequest) => {\n          return fetch(signedRequest.api, {\n            method: \"POST\",\n            headers: signedRequest.headers,\n            body: signedRequest.data\n          });\n        })\n        .then((response) => response.json())\n        .then((response) => {\n          return response;\n        });\n      console.log(\n        \">>>> rawShipmentsData DATA! \" +\n          JSON.stringify(rawShipmentsData, null, 2)\n      );\n\n      if (!rawShipmentsData.results) {\n        setShipmentsData([]);\n        setPaginationData(defaultPaginationData);\n        setShipmentsOverview(shipmentsOverview);\n        return;\n      }\n\n      // CALL: https://apigw.cargo-rivo-int.digital.aircanada.com/shipment_summary/details\n      const rawShipmentsOverview = await SignRequest(\n        \"POST\",\n        process.env.REACT_APP_API_BASE,\n        process.env.REACT_APP_AKAMAI_DBAAS_API_URL,\n        \"/shipment_summary/details\",\n        body\n      )\n        .then((signedRequest) => {\n          return fetch(signedRequest.api, {\n            method: \"POST\",\n            headers: signedRequest.headers,\n            body: signedRequest.data\n          });\n        })\n        .then((response) => response.json())\n        .then((response) => {\n          return response;\n        });\n\n      console.log(\n        \">>>> PROVIDER rawShipmentsOverview! \" +\n          JSON.stringify(rawShipmentsOverview, null, 2)\n      );\n\n      setShipmentsData(rawShipmentsData.results);\n\n      setShipmentsOverview({\n        booked: findTotalCountByEvent(rawShipmentsOverview, \"booked\"),\n        accepted: findTotalCountByEvent(rawShipmentsOverview, \"accepted\"),\n        inTransit: findTotalCountByEvent(rawShipmentsOverview, \"inTransit\"),\n        outForDelivery: findTotalCountByEvent(\n          rawShipmentsOverview,\n          \"outForDelivery\"\n        ),\n        deliveryAttempt: findTotalCountByEvent(\n          rawShipmentsOverview,\n          \"deliveryAttempt\"\n        ),\n        doorDelivered: findTotalCountByEvent(\n          rawShipmentsOverview,\n          \"doorDelivered\"\n        ),\n        missing: findTotalCountByEvent(rawShipmentsOverview, \"missing\"),\n        returnToShipper: findTotalCountByEvent(\n          rawShipmentsOverview,\n          \"returnToShipper\"\n        )\n      } as ShipmentsOverviewInterface);\n\n      console.log(\n        \">>>> rawShipmentsData.currentPage= \" + rawShipmentsData.currentPage\n      );\n      console.log(\n        \">>>> rawShipmentsData.pageCount= \" + rawShipmentsData.pageCount\n      );\n      console.log(\n        \">>>> rawShipmentsData.pageSize= \" + rawShipmentsData.pageSize\n      );\n\n      setPaginationData({\n        currentPage: rawShipmentsData.currentPage,\n        pageCount: rawShipmentsData.pageCount,\n        pageSize: rawShipmentsData.pageSize\n      } as PaginationDataInterface);\n\n      setLoading(false);\n      return rawShipmentsData;\n    } catch (e: any) {\n      console.log(e, \"ERROR SHIPMENTS PROVIDER\");\n      if (e.response?.status) {\n        setErrorCode(e.response?.status);\n      } else {\n        console.log(\">>>> ERROR SHIPMENTS PROVIDER EXCEPTION ERROR UNDEFINED! \");\n        setErrorCode(error.DEFAULT);\n      }\n      setLoading(false);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <ShipmentsContext.Provider\n      value={{\n        loading,\n        shipmentsData,\n        shipmentsOverview,\n        paginationData,\n        shipmentsQuery,\n        getShipmentsData\n      }}\n    >\n      {props.children}\n    </ShipmentsContext.Provider>\n  );\n};\n\nexport const useShipments = () => {\n  const context = React.useContext(ShipmentsContext);\n  return context;\n};\n"]},"metadata":{},"sourceType":"module"}